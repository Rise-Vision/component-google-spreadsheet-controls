if("undefined"==typeof CONFIG)var CONFIG={};!function(){"use strict";angular.module("risevision.widget.common.google-spreadsheet-controls",["risevision.widget.common.translate","risevision.widget.common.google-drive-picker","risevision.widget.common.tooltip"]).directive("spreadsheetControls",["$log","$templateCache","sheets",function(e,t,n){return{restrict:"E",scope:{spreadsheet:"="},template:t.get("spreadsheet-controls.html"),link:function(t){function s(){if(t.currentSheet){var e=t.currentSheet.value;e+="&headers="+Number(t.spreadsheet.headerRow),"range"===t.spreadsheet.cells&&""!==t.spreadsheet.range&&(e+="&range="+t.spreadsheet.range),t.spreadsheet.url=encodeURI(e)}}t.docURL="",t.docName="",t.sheets=[],t.currentSheet=null,t.defaultSetting={url:"",cells:"sheet",range:"",sheet:"",headerRow:!1,refresh:"60"},t.defaults=function(e){if(e)for(var t=1,n=arguments.length;n>t;t++){var s=arguments[t];for(var a in s)void 0===e[a]&&(e[a]=s[a])}return e},t.$watch("spreadsheet",function(e){t.defaults(e,t.defaultSetting)}),t.$watch("spreadsheet.range",s),t.$watch("spreadsheet.headerRow",s),t.$watch("currentSheet",function(e){e&&(t.spreadsheet.sheet=encodeURI(e.value),s())}),t.$on("picked",function(s,a){t.docName=a[0].name,t.docURL=a[0].url,n.getSheets(a[0].id).then(function(e){t.sheets=e,t.spreadsheet.sheet=encodeURI(e[0].value),t.currentSheet=e[0]}).then(null,e.error)}),t.$on("cancel",function(){e.debug("Spreadsheet Controls received event 'cancel'")})}}}])}(),function(){try{app=angular.module("risevision.widget.common.google-spreadsheet-controls")}catch(e){app=angular.module("risevision.widget.common.google-spreadsheet-controls",[])}app.run(["$templateCache",function(e){"use strict";e.put("spreadsheet-controls.html",'<div class="section">\n  <h5>{{"spreadsheet.heading" | translate}}</h5>\n  <div class="form-group">\n    <label>\n      {{"spreadsheet.select" | translate}} &nbsp; <google-drive-picker view-id="spreadsheets"></google-drive-picker>\n    </label>\n    <small class="help-block" ng-show="$error.notShared">\n      {{"spreadsheet.error.not-shared" | translate}}\n    </small>\n  </div>\n  <div class="row">\n    <div class="col-xs-10">\n      <div id="spreadsheet" class="well well-sm" ng-show="docURL !== \'\'">\n        <a target="_blank" href="{{ docURL }}">{{ docName }}</a>\n      </div>\n    </div>\n  </div>\n  <div id="spreadsheet-controls" ng-show="spreadsheet.url !== \'\'">\n    <div class="form-group">\n      <label>{{ "spreadsheet.cells.label" | translate }}</label>\n      <div class="radio">\n        <label for="cells-sheet">\n          <input id="cells-sheet" type="radio" name="cells" ng-model="spreadsheet.cells" value="sheet"> {{ "spreadsheet.cells.sheet" | translate }}\n        </label>\n      </div>\n      <div class="radio">\n        <label for="cells-range">\n          <input id="cells-range" type="radio" name="cells" ng-model="spreadsheet.cells" value="range"> {{ "spreadsheet.cells.range" | translate }}\n        </label>\n      </div>\n    </div>\n    <div class="form-group" ng-hide="spreadsheet.cells !== \'range\'">\n      <label for="range">{{ "spreadsheet.range.label" | translate }}</label>\n      <tooltip data-toggle="popover" data-placement="right"\n               data-content="{{\'spreadsheet.range.tooltip\' | translate}}">\n      </tooltip>\n      <div class="row">\n        <div class="col-xs-10">\n          <input id="range" name="range" ng-model="spreadsheet.range" class="form-control" type="text" />\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <label for="sheet">{{ "spreadsheet.sheet" | translate }}</label>\n      <div class="row">\n        <div class="col-xs-10">\n          <select id="sheet" name="sheet" ng-model="currentSheet" ng-options="sheet.label for sheet in sheets" class="form-control"></select>\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="checkbox">\n        <label for="headerRow">\n          <input id="headerRow" name="headerRow" ng-model="spreadsheet.headerRow" type="checkbox"> {{ "spreadsheet.headerRow.label" }}\n        </label>\n        <tooltip data-toggle="popover" data-placement="top"\n                 data-content="{{\'spreadsheet.headerRow.tooltip\' | translate}}">\n        </tooltip>\n      </div>\n    </div>\n    <div class="form-group">\n      <label for="refresh">{{ "spreadsheet.refresh.label" | translate }}</label>\n      <tooltip data-toggle="popover" data-placement="top"\n               data-content="{{\'spreadsheet.refresh.tooltip\' | translate}}">\n      </tooltip>\n      <div class="row">\n        <div class="col-xs-4 col-sm-3">\n          <input id="refresh" name="refresh" ng-model="spreadsheet.refresh" type="text" class="form-control" />\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(){"use strict";angular.module("risevision.widget.common.google-spreadsheet-controls").constant("SPREADSHEET_API_BASE","https://spreadsheets.google.com/feeds/worksheets/").constant("SPREADSHEET_API_SUFFIX","/public/basic").factory("sheets",["$http","$log","SPREADSHEET_API_BASE","SPREADSHEET_API_SUFFIX",function(e,t,n,s){var a={},r=function(e){var t,n,s=[];return angular.forEach(e.feed.entry,function(e){t=document.createElement("option"),t.text=e.title.$t,n=e.link[2].href,n=n.replace("&pub=1",""),t.value=-1===n.indexOf("/gviz/")?n:n.replace("spreadsheets.google.com","docs.google.com"),s.push(t)}),s};return a.getSheets=function(a){var o=Math.ceil(100*Math.random()),l=n+a+s;return e.get(encodeURI(l+"?alt=json&dummy="+o)).then(function(e){return e.data}).then(function(e){return r(e)}).then(null,function(e){throw t.error(e),e})},a}])}();
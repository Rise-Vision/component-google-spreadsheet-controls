if("undefined"==typeof CONFIG)var CONFIG={};!function(){"use strict";angular.module("risevision.widget.common.google-spreadsheet-controls",["risevision.widget.common.translate","risevision.widget.common.google-drive-picker","risevision.widget.common.tooltip"]).directive("spreadsheetControls",["$log","$templateCache","sheets",function(e,n,t){return{restrict:"E",require:"?ngModel",scope:{spreadsheet:"="},template:n.get("spreadsheet-controls.html"),link:function(e,n,s,o){function r(){if(e.currentSheet){var n=e.currentSheet.value;n+="&headers="+e.spreadsheet.headerRow,"range"===e.spreadsheet.cells&&""!==e.spreadsheet.range&&(n+="&range="+e.spreadsheet.range),e.spreadsheet.url=encodeURI(n)}}function a(){angular.extend(e.spreadsheet,d),e.sheets=[],e.currentSheet=null}function l(n){t.getSheets(n).then(function(n){e.published=!0,e.sheets=n,e.currentSheet=n[e.spreadsheet.sheetIndex]}).then(null,function(){e.published=!1,a()})}var i={docName:"",docURL:""},d={fileId:"",url:"",sheetIndex:0,cells:"sheet",range:"",headerRow:"-1",refresh:5},p=$(n).find("#sheet");e.sheets=[],e.currentSheet=null,e.published=!0,e.defaults=function(e){if(e)for(var n=1,t=arguments.length;t>n;n++){var s=arguments[n];for(var o in s)void 0===e[o]&&(e[o]=s[o])}return e},o&&e.$watch("spreadsheet.url",function(e){var n=!0;e&&""!==e||(n=!1),o.$setValidity("required",n)}),e.$watch("spreadsheet",function(n){e.defaults(n,d),e.defaults(n,i)}),e.$watch("spreadsheet.fileId",function(e){e&&""!==e&&l(e)}),e.$watch("spreadsheet.range",r),e.$watch("spreadsheet.headerRow",r),e.$watch("currentSheet",function(n){n&&(e.spreadsheet.sheetIndex=p[0].selectedIndex,r())}),e.$on("picked",function(n,t){e.spreadsheet.docName=t[0].name,e.spreadsheet.docURL=encodeURI(t[0].url),e.spreadsheet.fileId=t[0].id})}}}])}(),function(){try{app=angular.module("risevision.widget.common.google-spreadsheet-controls")}catch(e){app=angular.module("risevision.widget.common.google-spreadsheet-controls",[])}app.run(["$templateCache",function(e){"use strict";e.put("spreadsheet-controls.html",'<div class="section">\n  <h5>{{"spreadsheet.heading" | translate}}</h5>\n  <div class="form-group">\n    <label>\n      {{"spreadsheet.select" | translate}} &nbsp; <google-drive-picker view-id="spreadsheets"></google-drive-picker>\n    </label>\n    <div ng-if="!published">\n      <span class="text-danger">{{ "spreadsheet.error.publish" | translate }}</span>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-xs-10">\n      <div id="spreadsheet" class="well well-sm" ng-show="spreadsheet.docURL !== \'\'">\n        <a target="_blank" href="{{ spreadsheet.docURL }}">{{ spreadsheet.docName }}</a>\n      </div>\n    </div>\n  </div>\n  <div id="spreadsheet-controls" ng-show="spreadsheet.url !== \'\'">\n    <div class="form-group">\n      <label>{{ "spreadsheet.cells.label" | translate }}</label>\n      <div class="radio">\n        <label for="cells-sheet">\n          <input id="cells-sheet" type="radio" name="cells" ng-model="spreadsheet.cells" value="sheet"> {{ "spreadsheet.cells.sheet" | translate }}\n        </label>\n      </div>\n      <div class="radio">\n        <label for="cells-range">\n          <input id="cells-range" type="radio" name="cells" ng-model="spreadsheet.cells" value="range"> {{ "spreadsheet.cells.range" | translate }}\n        </label>\n      </div>\n    </div>\n    <div class="form-group" ng-hide="spreadsheet.cells !== \'range\'">\n      <label for="range">\n        {{ "spreadsheet.range.label" | translate }}\n      </label>\n      <span popover="{{\'spreadsheet.range.tooltip\' | translate}}" popover-trigger="click"\n            popover-placement="top" rv-tooltip></span>\n      <div class="row">\n        <div class="col-md-6">\n          <input id="range" name="range" ng-model="spreadsheet.range" class="form-control" type="text" />\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <label for="sheet">{{ "spreadsheet.sheet" | translate }}</label>\n      <select id="sheet" name="sheet" ng-model="currentSheet" ng-options="sheet.label for sheet in sheets" class="form-control"></select>\n    </div>\n    <div class="form-group">\n      <label for="headerRow">{{ "spreadsheet.headerRow.label" | translate }}</label>\n      <span popover="{{\'spreadsheet.headerRow.tooltip\' | translate}}" popover-trigger="click"\n            popover-placement="right" rv-tooltip></span>\n      <div class="row">\n        <div class="col-xs-6 col-md-3">\n          <select id="headerRow" name="headerRow" ng-model="spreadsheet.headerRow" class="form-control">\n            <option value="-1">{{\'spreadsheet.headerRow.auto\' | translate}}</option>\n            <option value="0">0</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="3">3</option>\n            <option value="4">4</option>\n            <option value="5">5</option>\n            <option value="6">6</option>\n            <option value="7">7</option>\n            <option value="8">8</option>\n            <option value="9">9</option>\n            <option value="10">10</option>\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <label for="refresh">{{ "spreadsheet.refresh.label" | translate }}</label>\n      <span popover="{{\'spreadsheet.refresh.tooltip\' | translate}}" popover-trigger="click"\n            popover-placement="top" rv-tooltip></span>\n      <div class="row">\n        <div class="col-xs-6 col-md-3">\n          <div class="input-group">\n            <input id="refresh" name="refresh" ng-model="spreadsheet.refresh" type="number" min="5" class="form-control" />\n            <span class="input-group-addon">{{\'common.units.minutes\' | translate}}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(){"use strict";angular.module("risevision.widget.common.google-spreadsheet-controls").constant("SPREADSHEET_API_BASE","https://spreadsheets.google.com/feeds/worksheets/").constant("SPREADSHEET_API_SUFFIX","/public/basic").factory("sheets",["$http","$log","SPREADSHEET_API_BASE","SPREADSHEET_API_SUFFIX",function(e,n,t,s){var o={},r=function(e){var n,t,s=[];return angular.forEach(e.feed.entry,function(e){n=document.createElement("option"),n.text=e.title.$t,t=e.link[2].href,t=t.replace("&pub=1",""),n.value=-1===t.indexOf("/gviz/")?t:t.replace("spreadsheets.google.com","docs.google.com"),s.push(n)}),s};return o.getSheets=function(n){var o=new Date,a=o.toLocaleDateString().split("/").join("")+o.getHours().toString(),l=t+n+s;return e.get(encodeURI(l+"?alt=json&dummy="+a)).then(function(e){return e.data}).then(function(e){return r(e)})},o}])}();